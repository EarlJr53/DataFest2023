---
title: "data"
output: html_document
date: "2023-04-14"
---

```{r}
library(tidyverse)
library(ggplot2)
```

Let's glimpse the datasets to get an overview of what variables we'll be working with.

```{r}
# Glimpse data
attorneys_data <- read_csv("data/DataFest_2023_Data/attorneys.csv")

attorneytimeentries <- read_csv("data/DataFest_2023_Data/attorneytimeentries.csv")

categories <- read_csv("data/DataFest_2023_Data/categories.csv")

clients <- read_csv("data/DataFest_2023_Data/clients.csv")

questionposts <- read_csv("data/DataFest_2023_Data/questionposts.csv")

questions <- read_csv("data/DataFest_2023_Data/questions.csv")

statesites <- read_csv("data/DataFest_2023_Data/statesites.csv")

subcategories <- read_csv("data/DataFest_2023_Data/subcategories.csv")

reporting_policy <- read_csv("data/reporting_policy.csv")
```

Determines list of states with full data since 2020-01-01 and over 3000 questions in that period.

```{r}
states_over_2400 <-
  questions %>%
  group_by(StateAbbr) %>%
  filter(AskedOnUtc >= "2020-01-01 00:00:00") %>% 
  count(StateAbbr) %>%
  filter(n >= 2400) %>%
  pull(StateAbbr)

relevant_states <-
  questions %>% 
  group_by(StateAbbr) %>% 
  summarize(start = min(AskedOnUtc)) %>%
  filter(
    start < "2020-01-01 00:00:00",
    StateAbbr %in% states_over_2400
  ) %>%
  pull(StateAbbr)
```

Tidy data, combine relevant states, reporting policy, and response rates.

```{r}
df_responses <-
  questions %>% 
  filter(StateAbbr %in% relevant_states) %>%
  group_by(StateAbbr) %>% 
  mutate(
    response_received = 1 * (TakenByAttorneyUno != "NULL")
  ) %>% 
  count(response_received) %>%
  pivot_wider(
    names_from = "response_received",
    names_prefix = "response_",
    values_from = "n"
  ) %>%
  rename(
    responses = response_1,
    nonresponses = response_0
  ) %>% 
  mutate(
    total_questions = nonresponses + responses,
    response_rate = responses / total_questions
  ) %>% 
  left_join(reporting_policy, by = c("StateAbbr" = "State"))
```

Plot by reporting policy

```{r}

```
