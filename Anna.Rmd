---
title: "Anna exploration"
output: html_document
date: "2023-04-14"
---

```{r}
library(tidyverse)
library(ggplot2)
```

```{r include=FALSE}
  # data on voleteer atorneys
attorneys_data <- read_csv("data/DataFest_2023_Data/attorneys.csv")
  # time sheet data 
attorneytimeentries <- read_csv("data/DataFest_2023_Data/attorneytimeentries.csv")
  # client 
clients <- read_csv("data/DataFest_2023_Data/clients.csv")

questionposts <- read_csv("data/DataFest_2023_Data/questionposts.csv")

questions <- read_csv("data/DataFest_2023_Data/questions.csv")

##

statesites <- read_csv("data/DataFest_2023_Data/statesites.csv")

  # Legal Services Corporation universal catagories for all states
categories <- read_csv("data/DataFest_2023_Data/categories.csv")
  # subcatagories spesific to states
subcategories <- read_csv("data/DataFest_2023_Data/statesites.csv")
```

```{r}
questionposts %>%
  filter(str_detect(PostText, "transgender")) %>%
  left_join(questions, by = "QuestionUno") %>%
  group_by(Category, Subcategory) %>%
  summarize()

```

```{r}
questions%>% 
  filter(StateAbbr=='MA') %>% 
  count(Subcategory) %>% 
  arrange(desc(n))

questions%>% 
  count(Subcategory) %>% 
  arrange(desc(n))
```

```{r}
questions%>% 
  filter(StateAbbr=='MA') %>% 
  count(Category) %>% 
  arrange(desc(n))

attorneys_data %>% 
  group_by(StateAbbr) %>% 
  count() %>% 
  arrange(desc(n))
```

Explore state income cut off qualifications

```{r}
statesites %>% 
  arrange(desc(BaseIncomeLimit))

statesites %>% 
  arrange(desc(IncomeMultiplier))

statesites %>% 
  arrange(desc(AllowedAssets))

statesites %>% 
  filter(StateAbbr=='PA')
```

```{r}
questions %>% 
  filter(StateAbbr=='TX', ) %>% 
  count(Subcategory) %>% 
  arrange(desc(n))

subcategories %>% 
  group_by(StateAbbr)
```

Create the mega data set!

```{r}
questions %>%
  left_join(clients, by = c("AskedByClientUno" = "ClientUno", "StateAbbr")) %>%
  group_by(StateAbbr) %>%
  mutate(
    is_null = 1 * (TakenByAttorneyUno == "NULL"),
  ) %>%
  count(is_null) %>%
  pivot_wider(
    names_from = "is_null",
    names_prefix = "null",
    values_from = "n"
  ) %>%
  mutate(
    null_percent = null1 / (null0 + null1)
  ) %>%
  arrange(desc(null_percent))


```

```{r}
questions%>% 
  filter(
    StateAbbr=='TX',
    # TakenByAttorneyUno == "NULL"
    ) %>%
  # mutate(
  #   is_null = (TakenByAttorneyUno == "NULL"),
  # ) %>%  
  ggplot() +
  geom_histogram(aes(x = AskedOnUtc, alpha = 0.2), bins = 72) +
  geom_histogram(data = . %>% filter(TakenByAttorneyUno == "NULL"), aes(x = AskedOnUtc, fill = StateAbbr), bins = 72)
  

```

```{r}
questions%>% 
  filter(
    StateAbbr=='FL',
    # TakenByAttorneyUno == "NULL"
    ) %>%
  # mutate(
  #   is_null = (TakenByAttorneyUno == "NULL"),
  # ) %>%  
  ggplot() +
  geom_histogram(aes(x = AskedOnUtc, alpha = 0.2), bins = 72) +
  geom_histogram(data = . %>% filter(TakenByAttorneyUno == "NULL"), aes(x = AskedOnUtc, fill = StateAbbr), bins = 72)
  
```

```{r}
questions%>% 
  filter(
    #StateAbbr== c('TX', 'FL','GA','AZ','IN','CA'),
    # TakenByAttorneyUno == "NULL"
    ) %>%
  # mutate(
  #   is_null = (TakenByAttorneyUno == "NULL"),
  # ) %>%  
  ggplot() +
  geom_histogram(aes(x = AskedOnUtc, alpha = 0.2), bins = 72) +
  geom_histogram(data = . %>% filter(TakenByAttorneyUno == "NULL"), aes(x = AskedOnUtc, fill = StateAbbr), bins = 72) +
  facet_wrap(facets =  vars(StateAbbr))
```

```{r}
questions%>% 
  filter(
    #StateAbbr== c('TX', 'FL','GA','AZ','IN','CA'),
    # TakenByAttorneyUno == "NULL",
    AskedOnUtc > '2020-01-01 12:00:00.000
'
    ) %>%
  # mutate(
  #   is_null = (TakenByAttorneyUno == "NULL"),
  # ) %>%  
  ggplot() +
  geom_histogram(aes(x = AskedOnUtc, alpha = 0.2), bins = 72) +
  geom_histogram(data = . %>% filter(TakenByAttorneyUno == "NULL"), aes(x = AskedOnUtc, fill = StateAbbr), bins = 72) +
  facet_wrap(facets =  vars(StateAbbr)) 
```

```{r}
attorneytimeentries %>%
  separate(EnteredOnUtc, into = "EnteredOnUtc", sep = " ", extra = "drop") %>% 
  group_by(EnteredOnUtc) %>%
  summarize(Hours = sum(Hours)) %>% 
  ggplot() +
  geom_col(aes(
    x = EnteredOnUtc,
    y = Hours
  ))
```
